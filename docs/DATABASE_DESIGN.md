# üóÑÔ∏è DATABASE DESIGN - AI SCHOOL DASHBOARD

## üìä ENTITY RELATIONSHIP DIAGRAM (ERD)

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê       ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê       ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   USERS     ‚îÇ       ‚îÇ  STUDENTS   ‚îÇ       ‚îÇ   CLASSES   ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§       ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§       ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ id (PK)     ‚îÇ‚óÑ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§ user_id(FK) ‚îÇ       ‚îÇ id (PK)     ‚îÇ
‚îÇ email       ‚îÇ       ‚îÇ id (PK)     ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫‚îÇ name        ‚îÇ
‚îÇ password    ‚îÇ       ‚îÇ first_name  ‚îÇ       ‚îÇ grade_level ‚îÇ
‚îÇ role        ‚îÇ       ‚îÇ last_name   ‚îÇ       ‚îÇ teacher_id  ‚îÇ
‚îÇ created_at  ‚îÇ       ‚îÇ dob         ‚îÇ       ‚îÇ academic_yr ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò       ‚îÇ class_id(FK)‚îÇ‚óÑ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§ created_at  ‚îÇ
       ‚îÇ              ‚îÇ created_at  ‚îÇ       ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ              ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò              ‚îÇ
       ‚îÇ                     ‚îÇ                     ‚îÇ
       ‚îÇ                     ‚îÇ                     ‚îÇ
       ‚îÇ              ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê             ‚îÇ
       ‚îÇ              ‚îÇ             ‚îÇ             ‚îÇ
       ‚îÇ              ‚ñº             ‚ñº             ‚îÇ
       ‚îÇ       ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ
       ‚îÇ       ‚îÇ   GRADES    ‚îÇ ‚îÇ ATTENDANCE  ‚îÇ   ‚îÇ
       ‚îÇ       ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§ ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§   ‚îÇ
       ‚îÇ       ‚îÇ id (PK)     ‚îÇ ‚îÇ id (PK)     ‚îÇ   ‚îÇ
       ‚îÇ       ‚îÇ student_id  ‚îÇ ‚îÇ student_id  ‚îÇ   ‚îÇ
       ‚îÇ       ‚îÇ course_id   ‚îÇ ‚îÇ date        ‚îÇ   ‚îÇ
       ‚îÇ       ‚îÇ grade       ‚îÇ ‚îÇ status      ‚îÇ   ‚îÇ
       ‚îÇ       ‚îÇ exam_type   ‚îÇ ‚îÇ notes       ‚îÇ   ‚îÇ
       ‚îÇ       ‚îÇ exam_date   ‚îÇ ‚îÇ created_at  ‚îÇ   ‚îÇ
       ‚îÇ       ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ
       ‚îÇ                                          ‚îÇ
       ‚îÇ                                          ‚îÇ
       ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê‚óÑ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
               ‚îÇ  TEACHERS   ‚îÇ
               ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
               ‚îÇ id (PK)     ‚îÇ
               ‚îÇ user_id(FK) ‚îÇ
               ‚îÇ first_name  ‚îÇ
               ‚îÇ last_name   ‚îÇ
               ‚îÇ department  ‚îÇ
               ‚îÇ created_at  ‚îÇ
               ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                      ‚îÇ
                      ‚îÇ
                      ‚ñº
               ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
               ‚îÇ  COURSES    ‚îÇ
               ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
               ‚îÇ id (PK)     ‚îÇ
               ‚îÇ name        ‚îÇ
               ‚îÇ code        ‚îÇ
               ‚îÇ teacher_id  ‚îÇ
               ‚îÇ class_id    ‚îÇ
               ‚îÇ semester    ‚îÇ
               ‚îÇ created_at  ‚îÇ
               ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## üìã B·∫¢NG CHI TI·∫æT

### 1. **users** - B·∫£ng ng∆∞·ªùi d√πng (Authentication)
L∆∞u th√¥ng tin ƒëƒÉng nh·∫≠p v√† ph√¢n quy·ªÅn cho t·∫•t c·∫£ ng∆∞·ªùi d√πng trong h·ªá th·ªëng.

| Column       | Type         | Constraints              | Description                    |
|--------------|--------------|--------------------------|--------------------------------|
| id           | UUID         | PRIMARY KEY              | Unique identifier              |
| email        | VARCHAR(255) | UNIQUE, NOT NULL         | Email ƒëƒÉng nh·∫≠p                |
| password_hash| VARCHAR(255) | NOT NULL                 | M·∫≠t kh·∫©u ƒë√£ hash (bcrypt)      |
| role         | ENUM         | NOT NULL                 | admin/teacher/parent/student   |
| is_active    | BOOLEAN      | DEFAULT true             | Tr·∫°ng th√°i t√†i kho·∫£n           |
| created_at   | TIMESTAMP    | DEFAULT CURRENT_TIMESTAMP| Th·ªùi gian t·∫°o                  |
| updated_at   | TIMESTAMP    | DEFAULT CURRENT_TIMESTAMP| Th·ªùi gian c·∫≠p nh·∫≠t             |

**Indexes:**
- `idx_users_email` ON (email)
- `idx_users_role` ON (role)

**Business Rules:**
- Email ph·∫£i unique v√† valid format
- Password ph·∫£i >= 8 k√Ω t·ª±
- Role m·∫∑c ƒë·ªãnh l√† 'student'

---

### 2. **students** - B·∫£ng h·ªçc sinh
Th√¥ng tin chi ti·∫øt v·ªÅ h·ªçc sinh.

| Column       | Type         | Constraints              | Description                    |
|--------------|--------------|--------------------------|--------------------------------|
| id           | UUID         | PRIMARY KEY              | Unique identifier              |
| user_id      | UUID         | FOREIGN KEY ‚Üí users(id)  | Li√™n k·∫øt v·ªõi b·∫£ng users        |
| first_name   | VARCHAR(100) | NOT NULL                 | T√™n                            |
| last_name    | VARCHAR(100) | NOT NULL                 | H·ªç                             |
| date_of_birth| DATE         | NOT NULL                 | Ng√†y sinh                      |
| gender       | ENUM         | CHECK(M/F/Other)         | Gi·ªõi t√≠nh                      |
| class_id     | UUID         | FOREIGN KEY ‚Üí classes(id)| L·ªõp hi·ªán t·∫°i                   |
| phone        | VARCHAR(20)  | NULL                     | S·ªë ƒëi·ªán tho·∫°i                  |
| address      | TEXT         | NULL                     | ƒê·ªãa ch·ªâ                        |
| parent_name  | VARCHAR(200) | NULL                     | T√™n ph·ª• huynh                  |
| parent_phone | VARCHAR(20)  | NULL                     | SƒêT ph·ª• huynh                  |
| created_at   | TIMESTAMP    | DEFAULT CURRENT_TIMESTAMP| Th·ªùi gian t·∫°o                  |
| updated_at   | TIMESTAMP    | DEFAULT CURRENT_TIMESTAMP| Th·ªùi gian c·∫≠p nh·∫≠t             |

**Indexes:**
- `idx_students_class` ON (class_id)
- `idx_students_user` ON (user_id)
- `idx_students_name` ON (first_name, last_name)

**Business Rules:**
- M·ªói user_id ch·ªâ ƒë∆∞·ª£c li√™n k·∫øt v·ªõi 1 student
- date_of_birth ph·∫£i >= 10 nƒÉm tr∆∞·ªõc
- class_id c√≥ th·ªÉ NULL (h·ªçc sinh m·ªõi ch∆∞a x·∫øp l·ªõp)

---

### 3. **teachers** - B·∫£ng gi√°o vi√™n
Th√¥ng tin chi ti·∫øt v·ªÅ gi√°o vi√™n.

| Column       | Type         | Constraints              | Description                    |
|--------------|--------------|--------------------------|--------------------------------|
| id           | UUID         | PRIMARY KEY              | Unique identifier              |
| user_id      | UUID         | FOREIGN KEY ‚Üí users(id)  | Li√™n k·∫øt v·ªõi b·∫£ng users        |
| first_name   | VARCHAR(100) | NOT NULL                 | T√™n                            |
| last_name    | VARCHAR(100) | NOT NULL                 | H·ªç                             |
| department   | VARCHAR(100) | NULL                     | Khoa/B·ªô m√¥n                    |
| phone        | VARCHAR(20)  | NULL                     | S·ªë ƒëi·ªán tho·∫°i                  |
| hire_date    | DATE         | NULL                     | Ng√†y b·∫Øt ƒë·∫ßu l√†m vi·ªác          |
| created_at   | TIMESTAMP    | DEFAULT CURRENT_TIMESTAMP| Th·ªùi gian t·∫°o                  |
| updated_at   | TIMESTAMP    | DEFAULT CURRENT_TIMESTAMP| Th·ªùi gian c·∫≠p nh·∫≠t             |

**Indexes:**
- `idx_teachers_user` ON (user_id)
- `idx_teachers_department` ON (department)

**Business Rules:**
- M·ªói user_id ch·ªâ ƒë∆∞·ª£c li√™n k·∫øt v·ªõi 1 teacher
- department c√≥ th·ªÉ NULL n·∫øu l√† gi√°o vi√™n thay th·∫ø

---

### 4. **classes** - B·∫£ng l·ªõp h·ªçc
Th√¥ng tin v·ªÅ c√°c l·ªõp h·ªçc.

| Column       | Type         | Constraints              | Description                    |
|--------------|--------------|--------------------------|--------------------------------|
| id           | UUID         | PRIMARY KEY              | Unique identifier              |
| name         | VARCHAR(100) | NOT NULL                 | T√™n l·ªõp (VD: 10A1)             |
| grade_level  | INTEGER      | CHECK(1-12)              | Kh·ªëi (6-12)                    |
| teacher_id   | UUID         | FOREIGN KEY ‚Üí teachers(id)| Gi√°o vi√™n ch·ªß nhi·ªám           |
| academic_year| INTEGER      | NOT NULL                 | NƒÉm h·ªçc (VD: 2024)             |
| room_number  | VARCHAR(50)  | NULL                     | Ph√≤ng h·ªçc                      |
| max_students | INTEGER      | DEFAULT 40               | Sƒ© s·ªë t·ªëi ƒëa                   |
| created_at   | TIMESTAMP    | DEFAULT CURRENT_TIMESTAMP| Th·ªùi gian t·∫°o                  |
| updated_at   | TIMESTAMP    | DEFAULT CURRENT_TIMESTAMP| Th·ªùi gian c·∫≠p nh·∫≠t             |

**Indexes:**
- `idx_classes_teacher` ON (teacher_id)
- `idx_classes_year` ON (academic_year)
- `idx_classes_grade` ON (grade_level)

**Business Rules:**
- T√™n l·ªõp ph·∫£i unique trong c√πng academic_year
- grade_level ph·∫£i trong kho·∫£ng 6-12 (c·∫•p 2-3)
- max_students m·∫∑c ƒë·ªãnh 40, c√≥ th·ªÉ ƒëi·ªÅu ch·ªânh

---

### 5. **courses** - B·∫£ng m√¥n h·ªçc
Danh s√°ch c√°c m√¥n h·ªçc v√† ph√¢n c√¥ng gi·∫£ng d·∫°y.

| Column       | Type         | Constraints              | Description                    |
|--------------|--------------|--------------------------|--------------------------------|
| id           | UUID         | PRIMARY KEY              | Unique identifier              |
| name         | VARCHAR(100) | NOT NULL                 | T√™n m√¥n (VD: To√°n h·ªçc)         |
| code         | VARCHAR(20)  | UNIQUE, NOT NULL         | M√£ m√¥n (VD: MATH101)           |
| teacher_id   | UUID         | FOREIGN KEY ‚Üí teachers(id)| Gi√°o vi√™n ph·ª• tr√°ch           |
| class_id     | UUID         | FOREIGN KEY ‚Üí classes(id)| L·ªõp h·ªçc m√¥n n√†y                |
| semester     | INTEGER      | CHECK(1,2)               | H·ªçc k·ª≥ (1 ho·∫∑c 2)              |
| academic_year| INTEGER      | NOT NULL                 | NƒÉm h·ªçc                        |
| credits      | INTEGER      | DEFAULT 1                | S·ªë t√≠n ch·ªâ                     |
| created_at   | TIMESTAMP    | DEFAULT CURRENT_TIMESTAMP| Th·ªùi gian t·∫°o                  |
| updated_at   | TIMESTAMP    | DEFAULT CURRENT_TIMESTAMP| Th·ªùi gian c·∫≠p nh·∫≠t             |

**Indexes:**
- `idx_courses_teacher` ON (teacher_id)
- `idx_courses_class` ON (class_id)
- `idx_courses_code` ON (code)

**Business Rules:**
- M√£ m√¥n (code) ph·∫£i unique
- M·ªôt m√¥n h·ªçc c√≥ th·ªÉ ƒë∆∞·ª£c d·∫°y b·ªüi nhi·ªÅu gi√°o vi√™n (c√°c l·ªõp kh√°c nhau)
- semester ph·∫£i l√† 1 ho·∫∑c 2

---

### 6. **grades** - B·∫£ng ƒëi·ªÉm s·ªë
L∆∞u tr·ªØ ƒëi·ªÉm s·ªë c·ªßa h·ªçc sinh cho t·ª´ng m√¥n.

| Column       | Type         | Constraints              | Description                    |
|--------------|--------------|--------------------------|--------------------------------|
| id           | UUID         | PRIMARY KEY              | Unique identifier              |
| student_id   | UUID         | FOREIGN KEY ‚Üí students(id)| H·ªçc sinh                      |
| course_id    | UUID         | FOREIGN KEY ‚Üí courses(id)| M√¥n h·ªçc                        |
| grade        | DECIMAL(5,2) | CHECK(0-10)              | ƒêi·ªÉm s·ªë (thang 10)             |
| exam_type    | ENUM         | NOT NULL                 | midterm/final/quiz/assignment  |
| exam_date    | DATE         | NOT NULL                 | Ng√†y thi/n·ªôp b√†i               |
| weight       | DECIMAL(3,2) | DEFAULT 1.0              | Tr·ªçng s·ªë (ƒë·ªÉ t√≠nh ƒëi·ªÉm TB)     |
| notes        | TEXT         | NULL                     | Ghi ch√∫ c·ªßa gi√°o vi√™n          |
| created_at   | TIMESTAMP    | DEFAULT CURRENT_TIMESTAMP| Th·ªùi gian t·∫°o                  |
| updated_at   | TIMESTAMP    | DEFAULT CURRENT_TIMESTAMP| Th·ªùi gian c·∫≠p nh·∫≠t             |

**Indexes:**
- `idx_grades_student` ON (student_id)
- `idx_grades_course` ON (course_id)
- `idx_grades_date` ON (exam_date)
- `idx_grades_student_course` ON (student_id, course_id)

**Business Rules:**
- ƒêi·ªÉm s·ªë ph·∫£i trong kho·∫£ng 0-10
- exam_type ph·∫£i thu·ªôc danh s√°ch cho ph√©p
- weight m·∫∑c ƒë·ªãnh 1.0, d√πng ƒë·ªÉ t√≠nh ƒëi·ªÉm trung b√¨nh c√≥ tr·ªçng s·ªë

---

### 7. **attendance** - B·∫£ng ƒëi·ªÉm danh
Theo d√µi chuy√™n c·∫ßn c·ªßa h·ªçc sinh.

| Column       | Type         | Constraints              | Description                    |
|--------------|--------------|--------------------------|--------------------------------|
| id           | UUID         | PRIMARY KEY              | Unique identifier              |
| student_id   | UUID         | FOREIGN KEY ‚Üí students(id)| H·ªçc sinh                      |
| course_id    | UUID         | FOREIGN KEY ‚Üí courses(id)| M√¥n h·ªçc (NULL = ƒëi·ªÉm danh chung)|
| date         | DATE         | NOT NULL                 | Ng√†y ƒëi·ªÉm danh                 |
| status       | ENUM         | NOT NULL                 | present/absent/late/excused    |
| notes        | TEXT         | NULL                     | Ghi ch√∫ (l√Ω do v·∫Øng...)        |
| created_at   | TIMESTAMP    | DEFAULT CURRENT_TIMESTAMP| Th·ªùi gian t·∫°o                  |
| updated_at   | TIMESTAMP    | DEFAULT CURRENT_TIMESTAMP| Th·ªùi gian c·∫≠p nh·∫≠t             |

**Indexes:**
- `idx_attendance_student` ON (student_id)
- `idx_attendance_date` ON (date)
- `idx_attendance_student_date` ON (student_id, date)
- `idx_attendance_course` ON (course_id)

**Business Rules:**
- M·ªôt h·ªçc sinh ch·ªâ c√≥ 1 record ƒëi·ªÉm danh/ng√†y (n·∫øu course_id = NULL)
- N·∫øu course_id kh√°c NULL, c√≥ th·ªÉ c√≥ nhi·ªÅu record/ng√†y (ƒëi·ªÉm danh t·ª´ng ti·∫øt)
- status ph·∫£i thu·ªôc danh s√°ch: present/absent/late/excused

---

## üîó QUAN H·ªÜ GI·ªÆA C√ÅC B·∫¢NG

1. **users ‚Üî students/teachers**: One-to-One
   - M·ªôt user ch·ªâ c√≥ th·ªÉ l√† student HO·∫∂C teacher
   - user.role x√°c ƒë·ªãnh lo·∫°i

2. **classes ‚Üî students**: One-to-Many
   - M·ªôt l·ªõp c√≥ nhi·ªÅu h·ªçc sinh
   - M·ªôt h·ªçc sinh thu·ªôc m·ªôt l·ªõp

3. **teachers ‚Üî classes**: One-to-Many
   - M·ªôt gi√°o vi√™n ch·ªß nhi·ªám nhi·ªÅu l·ªõp
   - M·ªôt l·ªõp c√≥ m·ªôt GVCN

4. **courses ‚Üî classes**: Many-to-One
   - M·ªôt l·ªõp c√≥ nhi·ªÅu m√¥n h·ªçc
   - M·ªôt m√¥n h·ªçc thu·ªôc m·ªôt l·ªõp c·ª• th·ªÉ

5. **students ‚Üî grades**: One-to-Many
   - M·ªôt h·ªçc sinh c√≥ nhi·ªÅu ƒëi·ªÉm
   - M·ªôt ƒëi·ªÉm thu·ªôc m·ªôt h·ªçc sinh

6. **courses ‚Üî grades**: One-to-Many
   - M·ªôt m√¥n c√≥ nhi·ªÅu ƒëi·ªÉm (c·ªßa nhi·ªÅu h·ªçc sinh)
   - M·ªôt ƒëi·ªÉm thu·ªôc m·ªôt m√¥n

7. **students ‚Üî attendance**: One-to-Many
   - M·ªôt h·ªçc sinh c√≥ nhi·ªÅu b·∫£n ghi ƒëi·ªÉm danh
   - M·ªôt b·∫£n ghi thu·ªôc m·ªôt h·ªçc sinh

---

## üìê CONSTRAINTS & VALIDATION RULES

### Database Level Constraints:
```sql
-- Check grade range
ALTER TABLE grades ADD CONSTRAINT check_grade_range 
CHECK (grade >= 0 AND grade <= 10);

-- Check age
ALTER TABLE students ADD CONSTRAINT check_student_age 
CHECK (date_of_birth <= CURRENT_DATE - INTERVAL '10 years');

-- Check grade level
ALTER TABLE classes ADD CONSTRAINT check_grade_level 
CHECK (grade_level >= 6 AND grade_level <= 12);

-- Unique class name per year
ALTER TABLE classes ADD CONSTRAINT unique_class_year 
UNIQUE (name, academic_year);

-- Unique attendance per student per day (general)
ALTER TABLE attendance ADD CONSTRAINT unique_attendance_student_date 
UNIQUE (student_id, date) WHERE course_id IS NULL;
```

### Application Level Validations:
- Email format validation (regex)
- Password strength (min 8 chars, 1 uppercase, 1 number)
- Phone number format (Vietnamese format)
- Future date prevention (exam_date, attendance date)

---

## üéØ INDEXES STRATEGY

### Priority 1 (Most Critical):
- Foreign keys (auto-indexed)
- Search fields (email, name)
- Filter fields (date, class_id, course_id)

### Priority 2 (Nice to Have):
- Composite indexes for common queries
- Sorting fields (created_at)

### Query Examples:
```sql
-- Get all students in a class with their grades
SELECT s.*, g.grade, c.name as course_name
FROM students s
JOIN grades g ON s.id = g.student_id
JOIN courses c ON g.course_id = c.id
WHERE s.class_id = ?;
-- Uses: idx_students_class, idx_grades_student

-- Calculate attendance rate
SELECT s.id, s.first_name, 
       COUNT(CASE WHEN a.status = 'present' THEN 1 END) * 100.0 / COUNT(*) as rate
FROM students s
JOIN attendance a ON s.id = a.student_id
WHERE a.date BETWEEN ? AND ?
GROUP BY s.id;
-- Uses: idx_attendance_student_date
```

---

## üìä DATA VOLUME ESTIMATES (1000 students)

| Table      | Estimated Rows | Growth Rate    |
|------------|----------------|----------------|
| users      | ~1,200         | +100/year      |
| students   | ~1,000         | +200/year      |
| teachers   | ~50            | +5/year        |
| classes    | ~30            | Stable         |
| courses    | ~300           | Stable         |
| grades     | ~50,000        | +10,000/year   |
| attendance | ~180,000       | +36,000/year   |

**Storage Estimate**: ~500 MB/year (without AI data)

---

## üîê SECURITY CONSIDERATIONS

1. **Passwords**: NEVER store plain text, always bcrypt hash
2. **PII Data**: Encrypt sensitive fields (phone, address)
3. **Access Control**: Row-level security based on user role
4. **Audit Trail**: Log all changes to grades
5. **Soft Delete**: Use `deleted_at` instead of hard delete

---

## üöÄ MIGRATION STRATEGY

1. Create tables in order (respect FK dependencies):
   - users ‚Üí teachers, classes
   - students ‚Üí courses
   - grades, attendance

2. Seed in order:
   - Admin user ‚Üí Teachers ‚Üí Classes
   - Students ‚Üí Courses
   - Mock grades & attendance

3. Create indexes AFTER bulk insert

---

**Document Version**: 1.0  
**Last Updated**: December 2024  
**Next Review**: After Phase 1 Testing
